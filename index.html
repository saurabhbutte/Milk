<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milk Distribution Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #2196F3;
            --primary-dark: #1976D2;
            --secondary: #4CAF50;
            --bg: #f4f7fa;
            --text: #333;
            --sidebar-width: 250px;
            --card-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        
        body { background-color: var(--bg); display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: #fff;
            height: 100%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #ddd;
            transition: 0.3s;
            z-index: 1000;
        }

        .brand {
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links { list-style: none; padding-top: 20px; }
        .nav-links li { padding: 0; }
        .nav-links li a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: #666;
            text-decoration: none;
            transition: 0.2s;
            gap: 15px;
        }
        .nav-links li a:hover, .nav-links li a.active {
            background: #e3f2fd;
            color: var(--primary);
            border-right: 4px solid var(--primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .menu-toggle { display: none; font-size: 24px; cursor: pointer; }

        h2 { color: #444; }

        /* Cards */
        .card {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }

        /* Dashboard Widgets */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            border-left: 5px solid var(--primary);
        }
        .stat-card h3 { font-size: 14px; color: #888; margin-bottom: 5px; }
        .stat-card .value { font-size: 24px; font-weight: bold; color: #333; }

        /* Forms */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #666; font-size: 0.9em; }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .row { display: flex; gap: 15px; }
        .col { flex: 1; }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
        }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-success { background: var(--secondary); color: #fff; }
        .btn-danger { background: #e53935; color: #fff; }
        .btn:hover { opacity: 0.9; }

        /* Tables */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: #555; }
        
        /* Utility */
        .hidden { display: none !important; }
        .text-success { color: var(--secondary); }
        .text-danger { color: #e53935; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .badge-active { background: #e8f5e9; color: #2e7d32; }

        /* Floating Action Button (Mobile) */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 900;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -250px; }
            .sidebar.active { left: 0; }
            .menu-toggle { display: block; }
            .row { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>

    <div class="sidebar" id="sidebar">
        <div class="brand">
            <i class="fas fa-cow"></i> Milk Manager
        </div>
        <ul class="nav-links">
            <li><a href="#" onclick="showSection('dashboard')" class="active" id="nav-dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#" onclick="showSection('customers')" id="nav-customers"><i class="fas fa-users"></i> Customers</a></li>
            <li><a href="#" onclick="showSection('delivery')" id="nav-delivery"><i class="fas fa-truck"></i> Deliveries</a></li>
            <li><a href="#" onclick="showSection('inventory')" id="nav-inventory"><i class="fas fa-flask"></i> Milk Inventory</a></li>
            <li><a href="#" onclick="showSection('billing')" id="nav-billing"><i class="fas fa-file-invoice-dollar"></i> Billing & Reports</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="header">
            <div class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
            <h2><span id="page-title">Dashboard</span></h2>
            <div class="date-display" id="current-date"></div>
        </div>

        <div id="dashboard-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Customers</h3>
                    <div class="value" id="dash-total-customers">0</div>
                </div>
                <div class="stat-card" style="border-left-color: var(--secondary);">
                    <h3>Today's Deliveries</h3>
                    <div class="value" id="dash-today-liters">0 L</div>
                </div>
                <div class="stat-card" style="border-left-color: #ff9800;">
                    <h3>Monthly Revenue</h3>
                    <div class="value" id="dash-month-rev">₹0</div>
                </div>
                <div class="stat-card" style="border-left-color: #e53935;">
                    <h3>Pending Bills</h3>
                    <div class="value" id="dash-pending">0</div>
                </div>
            </div>

            <div class="row">
                <div class="col card">
                    <h3>Revenue Overview</h3>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="col card">
                    <h3>Milk Type Distribution</h3>
                    <canvas id="milkTypeChart"></canvas>
                </div>
            </div>
        </div>

        <div id="customers-section" class="hidden">
            <div class="card">
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <h3>Customer List</h3>
                    <button class="btn btn-primary" onclick="openModal('customerModal')">+ Add Customer</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Address</th>
                                <th>Pref. Milk</th>
                                <th>Rate/L</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="customer-list-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="delivery-section" class="hidden">
            <div class="row">
                <div class="col card">
                    <h3>Record Delivery</h3>
                    <form onsubmit="event.preventDefault(); recordDelivery();">
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="delivery-date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Select Customer</label>
                            <select id="delivery-customer" class="form-control" onchange="updateRateDisplay()" required>
                                <option value="">-- Select --</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col form-group">
                                <label>Quantity (L)</label>
                                <input type="number" id="delivery-qty" step="0.5" class="form-control" placeholder="1.0" required>
                            </div>
                            <div class="col form-group">
                                <label>Rate (₹)</label>
                                <input type="number" id="delivery-rate" class="form-control" readonly>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%">Save Record</button>
                    </form>
                </div>

                <div class="col card">
                    <h3>Today's Records</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Qty</th>
                                    <th>Amt</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="today-delivery-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="inventory-section" class="hidden">
            <div class="card">
                <div style="display:flex; justify-content:space-between;">
                    <h3>Milk Inventory Entry</h3>
                    <button class="btn btn-success" onclick="exportInventory()"><i class="fas fa-file-excel"></i> Export</button>
                </div>
                <br>
                <form onsubmit="event.preventDefault(); saveInventory();">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="inv-date" class="form-control" required>
                    </div>

                    <div style="background:#e3f2fd; padding:15px; border-radius:8px; margin-bottom:15px;">
                        <h4 style="color:var(--primary); margin-bottom:10px;"><i class="fas fa-cow"></i> Cow Milk</h4>
                        <div class="row">
                            <div class="col form-group">
                                <label>Purchased (L)</label>
                                <input type="number" id="cow-purchased" class="form-control">
                            </div>
                            <div class="col form-group">
                                <label>Sold (L)</label>
                                <input type="number" id="cow-sold" class="form-control">
                            </div>
                            <div class="col form-group">
                                <label>To Dairy (L)</label>
                                <input type="number" id="cow-dairy" class="form-control">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col form-group">
                                <label>Fat %</label>
                                <input type="number" step="0.1" id="cow-fat" class="form-control">
                            </div>
                            <div class="col form-group">
                                <label>SNF %</label>
                                <input type="number" step="0.1" id="cow-snf" class="form-control">
                            </div>
                            <div class="col form-group">
                                <label>Rate (₹)</label>
                                <input type="number" id="cow-rate" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div style="background:#e8f5e9; padding:15px; border-radius:8px; margin-bottom:15px;">
                        <h4 style="color:var(--secondary); margin-bottom:10px;"><i class="fas fa-hippo"></i> Buffalo Milk</h4>
                        <div class="row">
                            <div class="col form-group">
                                <label>Purchased (L)</label>
                                <input type="number" id="buf-purchased" class="form-control">
                            </div>
                            <div class="col form-group">
                                <label>Sold (L)</label>
                                <input type="number" id="buf-sold" class="form-control">
                            </div>
                            <div class="col form-group">
                                <label>To Dairy (L)</label>
                                <input type="number" id="buf-dairy" class="form-control">
                            </div>
                        </div>
                         <div class="row">
                            <div class="col form-group">
                                <label>Fat %</label>
                                <input type="number" step="0.1" id="buf-fat" class="form-control">
                            </div>
                            <div class="col form-group">
                                <label>SNF %</label>
                                <input type="number" step="0.1" id="buf-snf" class="form-control">
                            </div>
                            <div class="col form-group">
                                <label>Rate (₹)</label>
                                <input type="number" id="buf-rate" class="form-control">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width:100%">Save Inventory</button>
                </form>
            </div>
            
            <div class="card" style="margin-top:20px;">
                <h3>History</h3>
                <div class="table-container">
                    <table id="inventory-history-table">
                        <thead>
                            <tr><th>Date</th><th>Type</th><th>Purchased</th><th>Sold</th><th>Revenue</th></tr>
                        </thead>
                        <tbody id="inventory-history-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="billing-section" class="hidden">
            <div class="card">
                <h3>Generate Bill</h3>
                <div class="row">
                    <div class="col form-group">
                        <label>Month</label>
                        <input type="month" id="bill-month" class="form-control">
                    </div>
                    <div class="col form-group">
                        <label>Customer</label>
                        <select id="bill-customer" class="form-control">
                            <option value="all">All Customers</option>
                        </select>
                    </div>
                    <div class="col form-group" style="display:flex; align-items:flex-end;">
                        <button class="btn btn-primary" onclick="generateBill()">Generate</button>
                    </div>
                </div>
            </div>

            <div class="card" id="bill-result">
                <h3>Bill Report</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Total Liters</th>
                                <th>Total Amount</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="bill-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <div id="customerModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; align-items:center; justify-content:center;">
        <div style="background:#fff; padding:20px; border-radius:8px; width:90%; max-width:400px;">
            <h3>Add New Customer</h3>
            <br>
            <form onsubmit="event.preventDefault(); saveCustomer();">
                <div class="form-group"><label>Name</label><input type="text" id="cust-name" class="form-control" required></div>
                <div class="form-group"><label>Phone</label><input type="tel" id="cust-phone" class="form-control" required></div>
                <div class="form-group"><label>Address</label><input type="text" id="cust-address" class="form-control"></div>
                <div class="row">
                    <div class="col form-group">
                        <label>Milk Type</label>
                        <select id="cust-type" class="form-control">
                            <option value="Cow">Cow</option>
                            <option value="Buffalo">Buffalo</option>
                        </select>
                    </div>
                    <div class="col form-group">
                        <label>Price/Liter</label>
                        <input type="number" id="cust-price" class="form-control" required>
                    </div>
                </div>
                <div style="text-align:right;">
                    <button type="button" class="btn" onclick="closeModal('customerModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- DATA MANAGEMENT ---
        let appData = {
            customers: [],
            deliveries: [],
            inventory: []
        };

        function loadData() {
            const saved = localStorage.getItem('milkApp_v1');
            if (saved) {
                appData = JSON.parse(saved);
            }
            // Set default date inputs to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('delivery-date').value = today;
            document.getElementById('inv-date').value = today;
            document.getElementById('bill-month').value = today.slice(0, 7);
            
            renderAll();
        }

        function saveData() {
            localStorage.setItem('milkApp_v1', JSON.stringify(appData));
            renderAll();
        }

        // --- NAVIGATION ---
        function showSection(sectionId) {
            document.querySelectorAll('.main-content > div[id$="-section"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(sectionId + '-section').classList.remove('hidden');
            
            document.querySelectorAll('.nav-links a').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + sectionId).classList.add('active');

            document.getElementById('page-title').innerText = sectionId.charAt(0).toUpperCase() + sectionId.slice(1);
            
            if(window.innerWidth <= 768) toggleSidebar(); // Auto close sidebar on mobile
            
            if(sectionId === 'dashboard') updateDashboard();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // --- CUSTOMER LOGIC ---
        function saveCustomer() {
            const newCust = {
                id: Date.now(),
                name: document.getElementById('cust-name').value,
                phone: document.getElementById('cust-phone').value,
                address: document.getElementById('cust-address').value,
                type: document.getElementById('cust-type').value,
                price: parseFloat(document.getElementById('cust-price').value),
                active: true
            };
            appData.customers.push(newCust);
            saveData();
            closeModal('customerModal');
            document.forms[1].reset(); // dirty hack to reset specific form
        }

        function renderCustomers() {
            const tbody = document.getElementById('customer-list-body');
            const select = document.getElementById('delivery-customer');
            const billSelect = document.getElementById('bill-customer');
            
            tbody.innerHTML = '';
            select.innerHTML = '<option value="">-- Select --</option>';
            billSelect.innerHTML = '<option value="all">All Customers</option>';

            appData.customers.forEach(c => {
                // Populate List
                const row = `<tr>
                    <td>${c.name}</td>
                    <td>${c.phone}</td>
                    <td>${c.address}</td>
                    <td><span class="badge" style="background:${c.type==='Cow'?'#e3f2fd':'#e8f5e9'}">${c.type}</span></td>
                    <td>₹${c.price}</td>
                    <td><button class="btn btn-danger" style="padding:5px 10px; font-size:12px;" onclick="deleteCustomer(${c.id})"><i class="fas fa-trash"></i></button></td>
                </tr>`;
                tbody.innerHTML += row;

                // Populate Dropdowns
                if(c.active) {
                    const opt = `<option value="${c.id}" data-rate="${c.price}">${c.name}</option>`;
                    select.innerHTML += opt;
                    billSelect.innerHTML += opt;
                }
            });
            document.getElementById('dash-total-customers').innerText = appData.customers.length;
        }

        function deleteCustomer(id) {
            if(confirm('Delete this customer?')) {
                appData.customers = appData.customers.filter(c => c.id !== id);
                saveData();
            }
        }

        // --- DELIVERY LOGIC ---
        function updateRateDisplay() {
            const select = document.getElementById('delivery-customer');
            const rate = select.options[select.selectedIndex].dataset.rate || 0;
            document.getElementById('delivery-rate').value = rate;
        }

        function recordDelivery() {
            const custId = document.getElementById('delivery-customer').value;
            const qty = parseFloat(document.getElementById('delivery-qty').value);
            const rate = parseFloat(document.getElementById('delivery-rate').value);
            const date = document.getElementById('delivery-date').value;

            if(!custId) return alert("Select a customer");

            const record = {
                id: Date.now(),
                date: date,
                customerId: parseInt(custId),
                qty: qty,
                rate: rate,
                amount: qty * rate
            };

            appData.deliveries.push(record);
            saveData();
            alert("Delivery Recorded!");
        }

        function renderTodaysDeliveries() {
            const today = new Date().toISOString().split('T')[0]; // Simple YYYY-MM-DD
            const list = appData.deliveries.filter(d => d.date === today);
            const tbody = document.getElementById('today-delivery-body');
            tbody.innerHTML = '';
            
            let totalL = 0;

            list.forEach(d => {
                const cust = appData.customers.find(c => c.id === d.customerId);
                totalL += d.qty;
                tbody.innerHTML += `<tr>
                    <td>${cust ? cust.name : 'Unknown'}</td>
                    <td>${d.qty} L</td>
                    <td>₹${d.amount}</td>
                    <td><i class="fas fa-check text-success"></i></td>
                </tr>`;
            });
            
            document.getElementById('dash-today-liters').innerText = totalL + " L";
        }

        // --- INVENTORY LOGIC ---
        function saveInventory() {
            const entry = {
                id: Date.now(),
                date: document.getElementById('inv-date').value,
                cow: {
                    purchased: document.getElementById('cow-purchased').value || 0,
                    sold: document.getElementById('cow-sold').value || 0,
                    rate: document.getElementById('cow-rate').value || 0
                },
                buffalo: {
                    purchased: document.getElementById('buf-purchased').value || 0,
                    sold: document.getElementById('buf-sold').value || 0,
                    rate: document.getElementById('buf-rate').value || 0
                }
            };
            
            // Remove existing entry for same date if exists
            appData.inventory = appData.inventory.filter(i => i.date !== entry.date);
            appData.inventory.push(entry);
            saveData();
            alert("Inventory Saved!");
            renderInventoryHistory();
        }
        
        function renderInventoryHistory() {
            const tbody = document.getElementById('inventory-history-body');
            tbody.innerHTML = '';
            // Sort by date desc
            appData.inventory.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(i => {
                tbody.innerHTML += `
                    <tr style="background:#f8f9fa"><td colspan="5"><strong>${i.date}</strong></td></tr>
                    <tr>
                        <td></td>
                        <td>Cow</td>
                        <td>${i.cow.purchased}</td>
                        <td>${i.cow.sold}</td>
                        <td>₹${(i.cow.sold * i.cow.rate).toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>Buffalo</td>
                        <td>${i.buffalo.purchased}</td>
                        <td>${i.buffalo.sold}</td>
                        <td>₹${(i.buffalo.sold * i.buffalo.rate).toFixed(2)}</td>
                    </tr>
                `;
            });
        }

        function exportInventory() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Date,Type,Purchased,Sold,To Dairy,Fat,SNF,Rate\n";
            
            appData.inventory.forEach(row => {
               csvContent += `${row.date},Cow,${row.cow.purchased},${row.cow.sold},0,0,0,${row.cow.rate}\n`;
               csvContent += `${row.date},Buffalo,${row.buffalo.purchased},${row.buffalo.sold},0,0,0,${row.buffalo.rate}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "milk_inventory.csv");
            document.body.appendChild(link);
            link.click();
        }

        // --- BILLING LOGIC ---
        function generateBill() {
            const monthStr = document.getElementById('bill-month').value;
            const custIdStr = document.getElementById('bill-customer').value;
            const tbody = document.getElementById('bill-body');
            tbody.innerHTML = '';

            let targetCustomers = appData.customers;
            if(custIdStr !== 'all') {
                targetCustomers = appData.customers.filter(c => c.id == custIdStr);
            }

            targetCustomers.forEach(cust => {
                // Filter deliveries for this customer in this month
                const dels = appData.deliveries.filter(d => 
                    d.customerId === cust.id && d.date.startsWith(monthStr)
                );
                
                if(dels.length === 0) return;

                const totalQty = dels.reduce((sum, d) => sum + d.qty, 0);
                const totalAmt = dels.reduce((sum, d) => sum + d.amount, 0);

                tbody.innerHTML += `<tr>
                    <td>${cust.name}</td>
                    <td>${totalQty.toFixed(1)} L</td>
                    <td>₹${totalAmt.toFixed(2)}</td>
                    <td><span class="badge badge-active">Pending</span></td>
                    <td><button class="btn btn-success" onclick="alert('Marked Paid')">Pay</button></td>
                </tr>`;
            });
        }

        // --- DASHBOARD CHARTS ---
        let revChart, typeChart;

        function updateDashboard() {
            // Calculate totals
            const currentMonth = new Date().toISOString().slice(0, 7);
            const thisMonthDeliveries = appData.deliveries.filter(d => d.date.startsWith(currentMonth));
            const rev = thisMonthDeliveries.reduce((acc, curr) => acc + curr.amount, 0);
            
            document.getElementById('dash-month-rev').innerText = "₹" + rev.toLocaleString();
            document.getElementById('dash-pending').innerText = "3"; // Mock data for now

            // Render Charts
            const ctx1 = document.getElementById('revenueChart').getContext('2d');
            const ctx2 = document.getElementById('milkTypeChart').getContext('2d');

            if(revChart) revChart.destroy();
            if(typeChart) typeChart.destroy();

            // Mock revenue data for chart
            revChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Revenue',
                        data: [rev*0.2, rev*0.5, rev*0.7, rev],
                        borderColor: '#2196F3',
                        tension: 0.4
                    }]
                }
            });

            // Calculate Cow vs Buffalo sales
            let cowSales = 0, bufSales = 0;
            thisMonthDeliveries.forEach(d => {
                const c = appData.customers.find(x => x.id === d.customerId);
                if(c && c.type === 'Cow') cowSales += d.amount;
                else bufSales += d.amount;
            });

            typeChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Cow Milk', 'Buffalo Milk'],
                    datasets: [{
                        data: [cowSales, bufSales],
                        backgroundColor: ['#2196F3', '#4CAF50']
                    }]
                }
            });
        }

        function renderAll() {
            renderCustomers();
            renderTodaysDeliveries();
            renderInventoryHistory();
            updateDashboard();
        }

        // --- INIT ---
        window.onload = loadData;

    </script>
</body>
</html>
